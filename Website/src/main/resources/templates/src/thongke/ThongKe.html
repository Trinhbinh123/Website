<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{src/partials/_head :: _head}">
    <script th:src="@{https://cdn.jsdelivr.net/npm/chart.js}"></script>
</head>
<body>
<div class="container-scroller">
    <!--_navbar -->
    <div th:replace="~{src/partials/_navbar :: _navbar}">
    </div>
    <!-- _navbar -->
    <div class="container-fluid page-body-wrapper">
        <!--_sidebar-->
        <div th:replace="~{src/partials/_sidebar :: _sidebar}"></div>
        <!--_sidebar-->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="container mt-5">
                    <h2>Thống kê hóa đơn theo tháng</h2>

                    <!-- Form chọn tháng -->
                    <form id="monthForm">
                        <div class="form-group">
                            <label for="month">Chọn tháng:</label>
                            <input type="month" id="month" name="month" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary">Xem thống kê</button>
                    </form>

                    <!-- Biểu đồ -->
                    <canvas id="chart" width="400" height="200"></canvas>

                </div>
            </div>
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

            <script>
                // Lắng nghe sự kiện submit của form
                document.getElementById("monthForm").addEventListener("submit", function(event) {
                    event.preventDefault();

                    const month = document.getElementById("month").value;

                    // Gửi yêu cầu tới backend để lấy thống kê
                    fetch(`/api/thong-ke-theo-thang?month=${month}`)
                        .then(response => response.json())
                        .then(data => {
                            // Vẽ biểu đồ
                            drawChart(data);
                        })
                        .catch(error => console.error('Error:', error));
                });

                // Hàm vẽ biểu đồ
                function drawChart(data) {
                    const labels = Object.keys(data); // Các tháng
                    const values = Object.values(data); // Tổng tiền

                    const ctx = document.getElementById('chart').getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Tổng tiền theo tháng',
                                data: values,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Tháng'
                                    }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Tổng tiền (VND)'
                                    }
                                }
                            }
                        }
                    });
                }
            </script>
            <!--footer-->
            <div th:replace="~{src/partials/_footer :: _footer}" th:width="100%"></div>
            <!--footer-->
        </div>
    </div>
</div>
<!--script -->
<div th:replace="~{src/partials/_script :: _script}"></div>
</body>
</html>